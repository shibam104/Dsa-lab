#include <stdio.h>
#include <stdlib.h>

struct Node {
    int data;
        struct Node *prev, *next;
        };

        struct Node *head = NULL;

        // Function to create a new node
        struct Node* createNode(int data) {
            struct Node* newNode = (struct Node*) malloc(sizeof(struct Node));
                newNode->data = data;
                    newNode->prev = newNode->next = NULL;
                        return newNode;
                        }

                        // Insert at given position (1 = front)
                        void insertAt(int data, int pos) {
                            struct Node* newNode = createNode(data);
                                if (!head) {  // Empty list
                                        if (pos != 1) {
                                                    printf("Invalid position! List is empty, only position 1 is allowed.\n");
                                                                free(newNode);
                                                                            return;
                                                                                    }
                                                                                            head = newNode;
                                                                                                    head->next = head;
                                                                                                            head->prev = head;
                                                                                                                    return;
                                                                                                                        }

                                                                                                                            int count = 1;
                                                                                                                                struct Node* temp = head;
                                                                                                                                    do {
                                                                                                                                            count++;
                                                                                                                                                    temp = temp->next;
                                                                                                                                                        } while (temp != head);

                                                                                                                                                            if (pos < 1 || pos > count + 1) {
                                                                                                                                                                    printf("Invalid position!\n");
                                                                                                                                                                            free(newNode);
                                                                                                                                                                                    return;
                                                                                                                                                                                        }

                                                                                                                                                                                            if (pos == 1) {  // Insert at front
                                                                                                                                                                                                    struct Node* tail = head->prev;
                                                                                                                                                                                                            newNode->next = head;
                                                                                                                                                                                                                    newNode->prev = tail;
                                                                                                                                                                                                                            tail->next = newNode;
                                                                                                                                                                                                                                    head->prev = newNode;
                                                                                                                                                                                                                                            head = newNode;
                                                                                                                                                                                                                                                } else if (pos == count + 1) { // Insert at end
                                                                                                                                                                                                                                                        struct Node* tail = head->prev;
                                                                                                                                                                                                                                                                newNode->next = head;
                                                                                                                                                                                                                                                                        newNode->prev = tail;
                                                                                                                                                                                                                                                                                tail->next = newNode;
                                                                                                                                                                                                                                                                                        head->prev = newNode;
                                                                                                                                                                                                                                                                                            } else {  // Insert at intermediate
                                                                                                                                                                                                                                                                                                    struct Node* temp = head;
                                                                                                                                                                                                                                                                                                            for (int i = 1; i < pos - 1; i++)
                                                                                                                                                                                                                                                                                                                        temp = temp->next;
                                                                                                                                                                                                                                                                                                                                newNode->next = temp->next;
                                                                                                                                                                                                                                                                                                                                        newNode->prev = temp;
                                                                                                                                                                                                                                                                                                                                                temp->next->prev = newNode;
                                                                                                                                                                                                                                                                                                                                                        temp->next = newNode;
                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                            // Delete node from given position
                                                                                                                                                                                                                                                                                                                                                            void deleteAt(int pos) {
                                                                                                                                                                                                                                                                                                                                                                if (!head) {
                                                                                                                                                                                                                                                                                                                                                                        printf("List is empty!\n");
                                                                                                                                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                        int count = 1;
                                                                                                                                                                                                                                                                                                                                                                                            struct Node* temp = head;
                                                                                                                                                                                                                                                                                                                                                                                                do {
                                                                                                                                                                                                                                                                                                                                                                                                        count++;
                                                                                                                                                                                                                                                                                                                                                                                                                temp = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                    } while (temp != head);

                                                                                                                                                                                                                                                                                                                                                                                                                        if (pos < 1 || pos > count - 1) {
                                                                                                                                                                                                                                                                                                                                                                                                                                printf("Invalid position!\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                if (count == 2) { // Only one node
                                                                                                                                                                                                                                                                                                                                                                                                                                                        free(head);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                head = NULL;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (pos == 1) { // Delete front
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        struct Node* tail = head->prev;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                struct Node* temp = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        head = head->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tail->next = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        head->prev = tail;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                free(temp);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else { // Delete at given position
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            struct Node* temp = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    for (int i = 1; i < pos; i++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                temp = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        temp->prev->next = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                temp->next->prev = temp->prev;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (temp == head) head = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                free(temp);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Display list
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    void display() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!head) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("List is empty!\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                struct Node* temp = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    printf("List: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        do {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("%d ", temp->data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        temp = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } while (temp != head);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Search element
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                void search(int key) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!head) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf("List is empty!\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            struct Node* temp = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                int pos = 1, found = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    do {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (temp->data == key) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("Element %d found at position %d\n", key, pos);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    found = 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    temp = temp->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            pos++;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } while (temp != head);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!found) printf("Element %d not found in the list.\n", key);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Reverse list
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    void reverse() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!head || head->next == head) return;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            struct Node* current = head;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                struct Node* temp = NULL;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    do {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            temp = current->prev;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    current->prev = current->next;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            current->next = temp;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    current = current->prev; // move to "next" node in original order
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } while (current != head);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            head = head->next; // new head after reversing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("List reversed successfully.\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Menu
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                int main() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    int choice, data, pos;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        while (1) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("\n--- Circular Doubly Linked List Menu ---\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("1. Insert at position\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("2. Delete at position\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("3. Display\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("4. Search\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("5. Reverse\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("6. Exit\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("Enter choice: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                scanf("%d", &choice);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        switch (choice) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    case 1:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    printf("Enter data: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    scanf("%d", &data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    printf("Enter position: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    scanf("%d", &pos);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    insertAt(data, pos);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                case 2:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("Enter position: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                scanf("%d", &pos);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                deleteAt(pos);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            case 3:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            display();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        case 4:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("Enter element to search: ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        scanf("%d", &data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        search(data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    case 5:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    reverse();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                case 6:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("Exiting...\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                exit(0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            default:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf("Invalid choice!\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }